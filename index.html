<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>MD5 T√†i/X·ªâu Analyzer</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: black;
      overflow: hidden;
      color: #00ffcc;
    }

    .container {
      position: relative;
      z-index: 2;
      padding: 40px;
      max-width: 500px;
      margin: auto;
      text-align: center;
    }

    h2 {
      font-size: 28px;
      text-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc;
    }

    input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      outline: none;
    }

    input {
      background: #111;
      color: #00ffcc;
      text-shadow: 0 0 5px #00ffcc;
    }

    button {
      background: #00ffcc;
      color: black;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 15px #00ffcc;
      transition: 0.3s;
    }

    button:hover {
      background: #00ffaa;
      box-shadow: 0 0 25px #00ffaa;
    }

    .hidden { display: none; }

    .output {
      margin-top: 20px;
      text-shadow: 0 0 10px #00ffcc;
    }

    /* Hi·ªáu ·ª©ng √°nh s√°ng chuy·ªÉn ƒë·ªông */
    .bg-lights {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle at 30% 30%, #00ffcc44, transparent 70%),
                  radial-gradient(circle at 70% 70%, #00ffaa22, transparent 80%);
      animation: moveBG 10s infinite linear;
      z-index: 0;
    }

    @keyframes moveBG {
      0% { background-position: 0 0, 100% 100%; }
      50% { background-position: 100% 0, 0 100%; }
      100% { background-position: 0 0, 100% 100%; }
    }
  </style>
</head>
<body>
  <div class="bg-lights"></div>

  <div class="container">
    <h2>üîÆ Gi·∫£i m√£ MD5 - D·ª± ƒëo√°n T√†i/X·ªâu</h2>

    <!-- B∆∞·ªõc 1 -->
    <div id="step1">
      <input type="text" id="md5Input" placeholder="Nh·∫≠p m√£ MD5..." />
      <button onclick="solveMD5()">Gi·∫£i MD5</button>
    </div>

    <!-- B∆∞·ªõc 2 -->
    <div id="step2" class="hidden">
      <div id="md5Info" class="output"></div>
      <input type="text" id="actualResult" placeholder="Nh·∫≠p k·∫øt qu·∫£ th·ª±c t·∫ø (t√†i/x·ªâu)" />
      <input type="text" id="resultString" placeholder="Nh·∫≠p chu·ªói k·∫øt qu·∫£ (VD: 3-4-5 ho·∫∑c {3-4-5})" />
      <button onclick="analyze()">Ho√†n t·∫•t ph√¢n t√≠ch</button>
    </div>

    <div id="output" class="output"></div>
  </div>

  <script>
    let history = [], correct = 0, total = 0, wrongStreak = 0, adjustmentFactor = 0;
    let lastPrediction = '', lastTai = 0, lastXiu = 0;

    function analyze_md5(md5, factor) {
      let value = 0;
      for (let i = 0; i < md5.length; i++) {
        value += md5.charCodeAt(i) * (i + 1);
      }
      value %= 1000;
      let tai_ratio = value / 1000;
      tai_ratio = Math.min(1, Math.max(0, tai_ratio + factor));
      let xiu_ratio = 1 - tai_ratio;
      return [+(tai_ratio * 100).toFixed(2), +(xiu_ratio * 100).toFixed(2)];
    }

    function parse_features(str) {
      let nums = str.match(/\d+/g);
      if (!nums || nums.length < 3) return [0, 0, 0];
      nums = nums.map(Number);
      let sum = nums[0] + nums[1] + nums[2];
      let even_ratio = [nums[0], nums[1], nums[2]].filter(n => n % 2 === 0).length / 3;
      let trend = (nums[1] > nums[0] && nums[2] > nums[1]) ? 1 : -1;
      return [sum, even_ratio, trend];
    }

    function adjust_prediction_factor(history, ws, sum, even, trend) {
      let adj = 0;
      if (history.length >= 3) {
        let p = history.slice(-3).join('');
        if (p === "t·∫£it·∫£it√†i" || p === "x·ªâux·ªâux·ªâu") {
          adj += 0.1 * (p.startsWith('t') ? -1 : 1);
        }
      }
      if (even > 0.6) adj += 0.05;
      else if (even < 0.4) adj -= 0.05;
      if (sum >= 9 && sum <= 12) adj += 0.03 * trend;
      if (ws >= 3) adj *= 1.5;
      else if (ws === 2) adj *= 1.2;
      return Math.max(-0.2, Math.min(0.2, adj));
    }

    function solveMD5() {
      let md5 = document.getElementById("md5Input").value.trim();
      if (!md5) return alert("Vui l√≤ng nh·∫≠p m√£ MD5");
      [lastTai, lastXiu] = analyze_md5(md5, adjustmentFactor);
      let diff = Math.abs(lastTai - lastXiu);
      lastPrediction = (diff < 5 && history.length > 0) ? history[history.length - 1] : (lastTai > lastXiu ? "t√†i" : "x·ªâu");

      document.getElementById("md5Info").innerHTML =
        `T·ª∑ l·ªá T√†i: <b>${lastTai}%</b><br>T·ª∑ l·ªá X·ªâu: <b>${lastXiu}%</b><br>D·ª± ƒëo√°n: <b>${lastPrediction.toUpperCase()}</b>`;
      document.getElementById("step2").classList.remove("hidden");
      document.getElementById("output").innerHTML = '';
    }

    function analyze() {
      let actual = document.getElementById("actualResult").value.trim().toLowerCase();
      let resultStr = document.getElementById("resultString").value.trim();
      if (!actual || !resultStr) return alert("Nh·∫≠p ƒë·ªß d·ªØ li·ªáu");
      let [sum, even, trend] = parse_features(resultStr);
      let actual_sum_result = sum >= 11 ? "t√†i" : "x·ªâu";

      total++;
      let msg = '';
      if (actual === lastPrediction && actual === actual_sum_result) {
        correct++; wrongStreak = 0;
        msg = "‚úÖ Ph√¢n t√≠ch ch√≠nh x√°c!";
      } else {
        wrongStreak++;
        msg = "‚ùå Ph√¢n t√≠ch sai!";
      }
      history.push(actual);
      if (history.length > 10) history.shift();
      adjustmentFactor = adjust_prediction_factor(history, wrongStreak, sum, even, trend);
      let accuracy = ((correct / total) * 100).toFixed(2);

      document.getElementById("output").innerHTML =
        `üéØ ƒê·ªô ch√≠nh x√°c: <b>${accuracy}%</b><br>‚öôÔ∏è H·ªá s·ªë ƒëi·ªÅu ch·ªânh: <b>${adjustmentFactor.toFixed(3)}</b><br>${msg}`;
    }
  </script>
</body>
</html>